<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Design Thinking Education - Pressure Meter</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- AOS (Animate on Scroll) -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <!-- JSZip for export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- FileSaver.js for export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <link rel="icon" href="https://img.icons8.com/external-flatart-icons-outline-flatarticons/64/external-shoe-footwear-flatart-icons-outline-flatarticons.png" />
  <style>
    html, body { height: 100%; font-family: 'Inter', 'Segoe UI', Arial, sans-serif; }
    .neu-card {
      background: var(--neu-bg);
      box-shadow: 8px 8px 24px var(--neu-shadowD), -8px -8px 24px var(--neu-shadowL);
      border-radius: 1.5rem;
      border: 1.5px solid var(--neu-border);
      transition: background 0.5s, box-shadow 0.5s, border 0.5s;
      position: relative;
    }
    .neu-card[data-aos] { transition: background 0.5s, box-shadow 0.5s, border 0.5s, transform 0.3s; }
    .neu-card .neu-header {
      font-weight: 600;
      font-size: 1.3rem;
      letter-spacing: 1px;
      color: var(--neu-text);
      text-shadow: 0 2px 8px var(--neu-shadowL);
    }
    :root[data-theme='light'] {
      --neu-bg: #f6f8fa;
      --neu-shadowD: #d9dde2;
      --neu-shadowL: #ffffff;
      --neu-border: #e7ebf0;
      --neu-text: #2d3748;
      --neu-text2: #687587;
      --neu-accent: #2f80ed;
      --neu-accent2: #27ae60;
      --neu-danger: #e74c3c;
      --neu-gray: #e2e8f0;
      --neu-subtle: #8ea2b6;
      --neu-meter1: #2f80ed;
      --neu-meter2: #e67e22;
      --neu-meter3: #27ae60;
      --neu-bg-card: #ffffffcc;
      --neu-bg-blur: rgba(246,248,250,0.7);
      --neu-switch: #d1d5db;
    }
    :root[data-theme='dark'] {
      --neu-bg: #22272e;
      --neu-shadowD: #1a1d22;
      --neu-shadowL: #31363c;
      --neu-border: #31363c;
      --neu-text: #e2e8f0;
      --neu-text2: #a0aec0;
      --neu-accent: #2196f3;
      --neu-accent2: #2ecc71;
      --neu-danger: #e74c3c;
      --neu-gray: #333840;
      --neu-subtle: #8ea2b6;
      --neu-meter1: #64b5f6;
      --neu-meter2: #ffb74d;
      --neu-meter3: #81c784;
      --neu-bg-card: #23272eec;
      --neu-bg-blur: rgba(34,39,46,0.7);
      --neu-switch: #4b5563;
    }
    .noise-bg::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.08;
      z-index: 1;
      background: url('https://grainy-gradients.vercel.app/noise.svg');
      mix-blend-mode: multiply;
      animation: noiseMove 12s infinite linear;
    }
    @keyframes noiseMove {
      0% { background-position: 0 0; }
      100% { background-position: 100px 100px; }
    }
    .bg-animated {
      background: linear-gradient(120deg, #e0e7ff 0%, #f6f8fa 90%);
      background-size: 400% 400%;
      animation: gradientBG 18s ease-in-out infinite;
    }
    [data-theme='dark'] .bg-animated {
      background: linear-gradient(120deg, #23272e 0%, #3b4252 100%);
      background-size: 400% 400%;
      animation: gradientBG 18s ease-in-out infinite;
    }
    @keyframes gradientBG {
      0%,100% {background-position:0% 50%;}
      50% {background-position:100% 50%;}
    }
    .glass-card {
      background: var(--neu-bg-blur);
      backdrop-filter: blur(12px) saturate(1.3);
      -webkit-backdrop-filter: blur(12px) saturate(1.3);
      border-radius: 1.5rem;
      border: 1.5px solid var(--neu-border);
      box-shadow: 0 6px 30px 0 var(--neu-shadowD);
      transition: background 0.5s;
    }
    .switch-wrapper { display: flex; align-items: center; gap: 0.5em; }
    .switch-label { font-size: 1rem; color: var(--neu-text2); font-weight: 500; }
    .switch { position: relative; width: 58px; height: 32px; display: inline-block; }
    .switch input { display:none; }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: var(--neu-switch);
      border-radius: 16px;
      box-shadow: 0 2px 8px var(--neu-shadowD);
      transition: background-color 0.3s;
    }
    .slider:before {
      content: "";
      position: absolute;
      left: 6px; top: 6px;
      height: 20px; width: 20px;
      background: var(--neu-accent);
      border-radius: 50%;
      transition: .3s;
      box-shadow: 0 2px 8px var(--neu-shadowL);
    }
    input:checked + .slider:before {
      transform: translateX(26px);
      background: var(--neu-accent2);
    }
    .chart-card {
      background: var(--neu-bg-blur);
      border-radius: 1.5rem;
      border: 1.5px solid var(--neu-border);
      box-shadow: 0 6px 30px 0 var(--neu-shadowD);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    h1 {
      font-size: clamp(2.2rem, 4vw, 3.4rem);
      font-weight: 700;
      color: var(--neu-accent);
      letter-spacing: -1px;
    }
    h2 {
      font-size: clamp(1.3rem, 2vw, 2rem);
      font-weight: 600;
      color: var(--neu-text);
    }
    .gradient-text {
      background: linear-gradient(90deg, var(--neu-accent), var(--neu-accent2), var(--neu-meter2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .fade-in { opacity: 0; animation: fadeIn 1s ease-in forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    .visually-hidden { position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .meter-bar {
      height: 14px;
      border-radius: 8px;
      background: linear-gradient(90deg, var(--neu-meter1) 0%, var(--neu-meter2) 100%);
      transition: width 0.6s cubic-bezier(.4,2,.6,1), background 0.4s;
    }
    .meter-bar.frustration { background: linear-gradient(90deg, var(--neu-danger) 0%, var(--neu-meter2) 100%);}
    .btn-export {
      background: linear-gradient(90deg, var(--neu-accent), var(--neu-accent2));
      color: #fff;
      font-weight: 600;
      border: none;
      border-radius: 999px;
      padding: 0.6em 1.8em;
      box-shadow: 0 4px 18px 0 var(--neu-shadowD);
      transition: box-shadow 0.2s, background 0.3s;
    }
    .btn-export:hover {
      box-shadow: 0 8px 32px 0 var(--neu-shadowL);
      background: linear-gradient(90deg, var(--neu-accent2), var(--neu-accent));
    }
    @media (max-width: 900px) {
      .cards-flex { flex-direction: column; gap: 2.4rem;}
    }
    @media (max-width: 600px) {
      .neu-card, .glass-card, .chart-card {padding: 1rem;}
      h1 {font-size:2rem;}
      h2 {font-size:1.1rem;}
    }
  </style>
</head>
<body class="bg-animated min-h-screen w-full relative noise-bg">
  <!-- HEADER -->
  <header class="w-full pt-8 pb-4 px-4 flex flex-col items-center fade-in" style="z-index:2; position:relative;">
    <h1 class="gradient-text text-center mb-2" aria-label="Design Thinking Education - Pressure Meter">Design Thinking Education<br><span class="gradient-text">Pressure Meter</span></h1>
    <div class="flex flex-wrap gap-4 items-center mt-2">
      <div class="switch-wrapper">
        <span class="switch-label">üåô</span>
        <label class="switch">
          <input type="checkbox" id="darkmode-toggle" aria-label="Toggle dark and light mode"/>
          <span class="slider"></span>
        </label>
        <span class="switch-label">‚òÄÔ∏è</span>
      </div>
      <div class="switch-wrapper ml-4">
        <span class="switch-label">Values</span>
        <label class="switch">
          <input type="checkbox" id="view-toggle" aria-label="Toggle between value input and visualisation"/>
          <span class="slider"></span>
        </label>
        <span class="switch-label">Visualisation</span>
      </div>
      <button class="btn-export ml-4" id="exportBtn" aria-label="Export data and visualisations">
        <svg class="inline mr-2" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 16V4m0 12l-4-4m4 4l4-4"/><rect x="4" y="16" width="16" height="4" rx="2"/></svg>
        Export
      </button>
    </div>
  </header>
  <main class="max-w-7xl mx-auto w-full px-3 py-4 fade-in" style="z-index:2; position:relative;">
    <section id="valuesView" class="cards-flex flex flex-row gap-8 justify-center items-stretch flex-wrap">
      <!-- Client Cards will be rendered here -->
    </section>
    <section id="visualisationView" class="hidden mt-6">
      <div class="flex flex-col gap-10">
        <div class="chart-card" id="chart-overall-container">
          <h2 class="mb-2 gradient-text">All Clients: Average Scores by Checkpoint</h2>
          <canvas id="chart-overall" height="120"></canvas>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="chart-card" id="chart-clientA-container">
            <h2 class="mb-2 gradient-text">Client A</h2>
            <canvas id="chart-clientA" height="120"></canvas>
          </div>
          <div class="chart-card" id="chart-clientB-container">
            <h2 class="mb-2 gradient-text">Client B</h2>
            <canvas id="chart-clientB" height="120"></canvas>
          </div>
          <div class="chart-card" id="chart-clientC-container">
            <h2 class="mb-2 gradient-text">Client C</h2>
            <canvas id="chart-clientC" height="120"></canvas>
          </div>
        </div>
      </div>
    </section>
  </main>
  <footer class="w-full text-center py-6 text-base text-[var(--neu-text2)] font-medium fade-in" style="z-index:2; position:relative;">
    ¬© 2025 Design Thinking Education. Master of Education. Faculty of Education. HKU 
  </footer>
  <script>
    const htmlEl = document.documentElement;
    const darkToggle = document.getElementById('darkmode-toggle');
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      htmlEl.setAttribute('data-theme', 'dark');
      darkToggle.checked = true;
    }
    darkToggle.addEventListener('change', () => {
      htmlEl.setAttribute('data-theme', darkToggle.checked ? 'dark' : 'light');
      setTimeout(() => updateChartsTheme(), 100);
    });

    const CLIENTS = [
      {id: 'A', name: 'Client A', color: 'var(--neu-meter1)', img: 'https://picsum.photos/seed/a1/120/120'},
      {id: 'B', name: 'Client B', color: 'var(--neu-meter2)', img: 'https://picsum.photos/seed/b1/120/120'},
      {id: 'C', name: 'Client C', color: 'var(--neu-meter3)', img: 'https://picsum.photos/seed/c1/120/120'}
    ];
    const CHECKPOINT_COUNT = 4;
    const TEAMS_RANGE = [1,2,3];
    const QUESTIONS = [
      {
        label: 'Do you feel comfortable sharing your true thoughts to the designers?',
        key: 'comfortable',
        icon: 'ü§ù'
      },
      {
        label: 'Do you feel the designers being frustrated by your feedback?',
        key: 'frustrated',
        icon: 'üò¨'
      }
    ];

    let data = {};
    CLIENTS.forEach(client => {
      data[client.id] = { teams: 2, values: Array(3).fill().map(() => (
          Array(CHECKPOINT_COUNT).fill().map(() => ({comfortable: '', frustrated: ''}))
        ))
      };
    });
    function setTeamCount(clientId, count) {
      data[clientId].teams = count;
      while (data[clientId].values.length < count) {
        data[clientId].values.push(
          Array(CHECKPOINT_COUNT).fill().map(() => ({comfortable: '', frustrated: ''}))
        );
      }
      while (data[clientId].values.length > count) data[clientId].values.pop();
    }

    function renderClientCards() {
      const container = document.getElementById('valuesView');
      container.innerHTML = '';
      CLIENTS.forEach((client, ci) => {
        const clientData = data[client.id];
        const teamSelector = `
          <label for="teams-${client.id}" class="block mb-2 font-medium text-[var(--neu-text2)]">Teams: </label>
          <select id="teams-${client.id}" class="rounded-lg px-4 py-2 shadow-sm bg-[var(--neu-bg-card)] focus:ring-2 focus:ring-[var(--neu-accent)] font-semibold text-base" aria-label="Team count for ${client.name}">
            ${TEAMS_RANGE.map(n=>`<option value="${n}" ${clientData.teams==n?'selected':''}>${n}</option>`).join('')}
          </select>
        `;
        let teamBlocks = '';
        for(let t=0; t<clientData.teams; t++) {
          teamBlocks += `
          <div class="mt-3 mb-4 glass-card p-3">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-lg font-semibold text-[var(--neu-accent)]">Team ${t+1}</span>
              <img src="https://picsum.photos/seed/${client.id}t${t+1}/36/36" alt="Team ${t+1}" class="rounded-full shadow-md border border-[var(--neu-border)]"/>
            </div>
            <div class="grid grid-cols-1 gap-2">
              ${Array(CHECKPOINT_COUNT).fill().map((_,cpk) => `
                <div class="glass-card p-2 flex flex-col gap-1" style="background:rgba(255,255,255,0.6); margin-bottom:6px;">
                  <span class="font-medium text-xs text-[var(--neu-text2)]">Checkpoint ${cpk+1}</span>
                  ${QUESTIONS.map(q => `
                  <label class="flex items-center gap-2 mt-1 mb-1" for="${client.id}-t${t}-cp${cpk}-${q.key}">
                    <span class="text-base">${q.icon}</span>
                    <span class="text-xs font-semibold text-[var(--neu-text)]">${q.label}</span>
                    <input 
                      id="${client.id}-t${t}-cp${cpk}-${q.key}"
                      type="number" min="0" max="10" step="1"
                      class="ml-2 w-16 text-center rounded-lg border border-[var(--neu-gray)] px-2 py-1 bg-white/80 text-[var(--neu-text)] font-bold focus:ring-2 focus:ring-[var(--neu-accent)]"
                      value="${clientData.values[t][cpk][q.key] ?? ''}"
                      aria-label="${client.name}, Team ${t+1}, Checkpoint ${cpk+1}, ${q.label}"
                      oninput="onInputChange('${client.id}',${t},${cpk},'${q.key}',this)"
                    />
                    <span class="text-[var(--neu-text2)] text-xs ml-1">/10</span>
                  </label>
                  <div class="w-full h-3 rounded-xl mb-1 bg-[var(--neu-gray)] relative overflow-hidden">
                    <div class="meter-bar ${q.key=='frustrated'?'frustration':''}" style="width:${(clientData.values[t][cpk][q.key]||0)*10}%;"></div>
                  </div>
                  `).join('')}
                </div>
              `).join('')}
            </div>
          </div>
          `;
        }
        const cardHTML = `
          <section data-aos="fade-up" class="neu-card flex-1 min-w-[340px] max-w-[450px] p-6 flex flex-col justify-between" aria-label="${client.name}">
            <div class="flex items-center gap-4 mb-3 mt-1">
              <img src="${client.img}" width="60" height="60" class="rounded-full shadow-lg border-2 border-[var(--neu-border)]" alt="${client.name} profile"/>
              <div>
                <span class="neu-header text-xl">${client.name}</span>
                <div>${teamSelector}</div>
              </div>
            </div>
            <div class="flex-1">
              ${teamBlocks}
            </div>
          </section>
        `;
        container.insertAdjacentHTML('beforeend', cardHTML);
        setTimeout(()=>{
          document.getElementById(`teams-${client.id}`).addEventListener('change', function() {
            setTeamCount(client.id, parseInt(this.value));
            renderClientCards();
            updateCharts();
          });
        },50);
      });
    }
    window.onInputChange = function(clientId, t, cpk, qkey, el) {
      let val = parseInt(el.value);
      if(isNaN(val) || val < 0) val = 0;
      if(val > 10) val = 10;
      data[clientId].values[t][cpk][qkey] = val;
      el.value = val;
      const meter = el.parentElement.parentElement.querySelector('.meter-bar'+(qkey=='frustrated'?'.frustration':''));
      if(meter) {
        meter.style.width = (val*10) + '%';
        gsap.to(meter, {width: (val*10)+'%', duration:0.6, ease:"power2.out"});
      }
      updateCharts();
    }

    const viewToggle = document.getElementById('view-toggle');
    const valuesView = document.getElementById('valuesView');
    const visualisationView = document.getElementById('visualisationView');
    viewToggle.addEventListener('change', () => {
      valuesView.classList.toggle('hidden', viewToggle.checked);
      visualisationView.classList.toggle('hidden', !viewToggle.checked);
      if(viewToggle.checked) updateCharts();
    });

    // --- LINE CHART LOGIC ---
    let chartOverall, chartA, chartB, chartC;
    function getAverages(data) {
      let result = {};
      CLIENTS.forEach(client=>{
        let {teams, values} = data[client.id];
        result[client.id] = Array(CHECKPOINT_COUNT).fill().map((_,cpk)=>({
          comfortable: 0,
          frustrated: 0,
          n: 0
        }));
        for(let t=0; t<teams; t++) {
          for(let cpk=0; cpk<CHECKPOINT_COUNT; cpk++) {
            QUESTIONS.forEach(q=>{
              let val = parseInt(values[t][cpk][q.key]);
              if(!isNaN(val)) {
                result[client.id][cpk][q.key] += val;
                result[client.id][cpk].n++;
              }
            });
          }
        }
        for(let cpk=0; cpk<CHECKPOINT_COUNT; cpk++) {
          QUESTIONS.forEach(q=>{
            if(result[client.id][cpk].n>0) result[client.id][cpk][q.key] = result[client.id][cpk][q.key]/result[client.id][cpk].n*2;
            else result[client.id][cpk][q.key] = 0;
          });
        }
      });
      let overall = Array(CHECKPOINT_COUNT).fill().map(()=>({comfortable:0,frustrated:0,n:0}));
      CLIENTS.forEach(client=>{
        for(let cpk=0; cpk<CHECKPOINT_COUNT; cpk++) {
          QUESTIONS.forEach(q=>{
            overall[cpk][q.key] += result[client.id][cpk][q.key];
          });
          overall[cpk].n += 1;
        }
      });
      for(let cpk=0; cpk<CHECKPOINT_COUNT; cpk++) {
        QUESTIONS.forEach(q=>{
          if(overall[cpk].n>0) overall[cpk][q.key] /= overall[cpk].n;
          else overall[cpk][q.key] = 0;
        });
      }
      return {clients: result, overall};
    }

    function updateChartsTheme() {
      [chartOverall,chartA,chartB,chartC].forEach(chart=>{
        if(chart) {
          chart.options.plugins.legend.labels.color = getComputedStyle(htmlEl).getPropertyValue('--neu-text');
          chart.options.scales.x.ticks.color = getComputedStyle(htmlEl).getPropertyValue('--neu-text');
          chart.options.scales.y.ticks.color = getComputedStyle(htmlEl).getPropertyValue('--neu-text');
          chart.update();
        }
      });
    }

    function updateCharts() {
      const avgs = getAverages(data);
      const theme = htmlEl.getAttribute('data-theme');
      let bg1 = getComputedStyle(htmlEl).getPropertyValue('--neu-bg-card'),
          txt = getComputedStyle(htmlEl).getPropertyValue('--neu-text'),
          meter1 = getComputedStyle(htmlEl).getPropertyValue('--neu-meter1'),
          meter2 = getComputedStyle(htmlEl).getPropertyValue('--neu-meter2'),
          meter3 = getComputedStyle(htmlEl).getPropertyValue('--neu-meter3'),
          danger = getComputedStyle(htmlEl).getPropertyValue('--neu-danger');
      // Chart.js config for LINE CHARTS
      if(chartOverall) chartOverall.destroy();
      if(chartA) chartA.destroy(); if(chartB) chartB.destroy(); if(chartC) chartC.destroy();
      chartOverall = new Chart(document.getElementById('chart-overall').getContext('2d'), {
        type: 'line',
        data: {
          labels: Array(CHECKPOINT_COUNT).fill().map((_,i)=>'Checkpoint '+(i+1)),
          datasets: [
            {
              label: QUESTIONS[0].label,
              data: avgs.overall.map(c=>c.comfortable),
              backgroundColor: meter1+'55',
              borderColor: meter1,
              tension: 0.3,
              borderWidth: 3,
              pointBackgroundColor: meter1,
              pointBorderColor: '#fff',
              fill: false
            },
            {
              label: QUESTIONS[1].label,
              data: avgs.overall.map(c=>c.frustrated),
              backgroundColor: danger+'55',
              borderColor: danger,
              tension: 0.3,
              borderWidth: 3,
              pointBackgroundColor: danger,
              pointBorderColor: '#fff',
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {color: txt, font: {size:14, weight:'bold'}}
            },
            title: {display:false}
          },
          scales: {
            x: {ticks: {color: txt}, grid: {display:false}},
            y: {beginAtZero:true,max:10,ticks:{color:txt,stepSize:2}}
          }
        }
      });
      [chartA, chartB, chartC] = CLIENTS.map((client, idx)=>{
        let cid = client.id, canvasId = `chart-client${cid}`;
        return new Chart(document.getElementById(canvasId).getContext('2d'), {
          type: 'line',
          data: {
            labels: Array(CHECKPOINT_COUNT).fill().map((_,i)=>'Checkpoint '+(i+1)),
            datasets: [
              {
                label: QUESTIONS[0].label,
                data: avgs.clients[cid].map(c=>c.comfortable),
                backgroundColor: [meter1, meter2, meter3][idx]+'55',
                borderColor: [meter1, meter2, meter3][idx],
                tension: 0.3,
                borderWidth: 3,
                pointBackgroundColor: [meter1, meter2, meter3][idx],
                pointBorderColor: '#fff',
                fill: false
              },
              {
                label: QUESTIONS[1].label,
                data: avgs.clients[cid].map(c=>c.frustrated),
                backgroundColor: danger+'55',
                borderColor: danger,
                tension: 0.3,
                borderWidth: 3,
                pointBackgroundColor: danger,
                pointBorderColor: '#fff',
                fill: false
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {position:'top',labels:{color:txt,font:{size:14, weight:'bold'}}},
              title: {display:false}
            },
            scales: {
              x: {ticks:{color:txt},grid:{display:false}},
              y: {beginAtZero:true,max:10,ticks:{color:txt,stepSize:2}}
            }
          }
        });
      });
    }

    document.getElementById('exportBtn').addEventListener('click', async function() {
      const zip = new JSZip();
      zip.file('raw-data.json', JSON.stringify(data, null, 2));
      let csv = 'Client,Team,Checkpoint,Question,Score\n';
      CLIENTS.forEach(client=>{
        let cd = data[client.id];
        for(let t=0; t<cd.teams; t++) {
          for(let cpk=0; cpk<CHECKPOINT_COUNT; cpk++) {
            QUESTIONS.forEach(q=>{
              let v = cd.values[t][cpk][q.key];
              csv += `${client.id},${t+1},${cpk+1},${q.key},${v}\n`;
            });
          }
        }
      });
      zip.file('raw-data.csv', csv);

      const chartElements = [
        {name:'overall', chart:chartOverall, canvas:'chart-overall'},
        {name:'clientA', chart:chartA, canvas:'chart-clientA'},
        {name:'clientB', chart:chartB, canvas:'chart-clientB'},
        {name:'clientC', chart:chartC, canvas:'chart-clientC'},
      ];
      for(let {name,canvas} of chartElements) {
        const el = document.getElementById(canvas);
        if(el) {
          let blob = await new Promise(resolve=>el.toBlob(resolve));
          zip.file(`visualisation-${name}.png`, blob);
        }
      }
      zip.generateAsync({type:'blob'}).then(function(content) {
        saveAs(content, 'pressure-meter-export.zip');
      });
    });

    AOS.init({duration:800, once:true});
    renderClientCards();
    updateCharts();
    document.querySelectorAll('.fade-in').forEach(el=>gsap.to(el, {opacity:1, duration:1, y:0, delay:0.1}));
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',e=>{
      htmlEl.setAttribute('data-theme', e.matches ? 'dark' : 'light');
      setTimeout(()=>updateChartsTheme(), 100);
    });
    window.addEventListener('input', ()=>{
      if(viewToggle.checked) updateCharts();
    });
    window.addEventListener('resize', ()=>{
      if(viewToggle.checked) updateCharts();
    });
  </script>
</body>
</html>
